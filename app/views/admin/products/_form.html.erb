<%= form_with model: [:admin, @product], local: true, multipart: true do |f| %>
  <% if @product.errors.any? %>
    <div class="alert alert-danger">
      <h6>Please fix the following errors:</h6>
      <ul class="mb-0">
        <% @product.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="row">
    <div class="col-md-8">
      <div class="mb-3">
        <%= f.label :name, class: "form-label" %>
        <%= f.text_field :name, class: "form-control", required: true %>
      </div>

      <div class="mb-3">
        <%= f.label :description, class: "form-label" %>
        <%= f.text_area :description, rows: 4, class: "form-control", required: true %>
      </div>

      <div class="row">
        <div class="col-md-4">
          <div class="mb-3">
            <%= f.label :category_id, "Category", class: "form-label" %>
            <%= f.select :category_id, options_from_collection_for_select(@categories, :id, :name, @product.category_id),
                         { prompt: "Select category" }, { class: "form-select", required: true } %>
          </div>
        </div>
        <div class="col-md-4">
          <div class="mb-3">
            <%= label_tag :price, "Price ($)", class: "form-label" %>
            <%= number_field_tag :price, (@product.current_price if @product.persisted?),
                                 step: 0.01, min: 0, class: "form-control", required: true %>
          </div>
        </div>
        <div class="col-md-4">
          <div class="mb-3">
            <%= f.label :stock_quantity, "Stock Quantity", class: "form-label" %>
            <%= f.number_field :stock_quantity, min: 0, class: "form-control", required: true %>
          </div>
        </div>
      </div>

      <div class="mb-3">
        <%= f.label :image, "Product Image", class: "form-label" %>
        <%= f.file_field :image, class: "form-control", accept: "image/*" %>
        <div class="form-text">Upload JPG, PNG, or GIF images</div>
      </div>

      <div class="mb-3">
        <%= f.label :image_url, "Or Image URL", class: "form-label" %>
        <%= f.url_field :image_url, class: "form-control", placeholder: "https://example.com/image.jpg" %>
        <div class="form-text">Alternative: provide a direct URL to an image</div>
      </div>
    </div>

    <div class="col-md-4">
      <% if @product.persisted? %>
        <div class="mb-3">
          <label class="form-label">Current Image</label>
          <div class="border rounded p-2">
            <% if @product.image.attached? %>
              <%= image_tag @product.image, class: "img-fluid rounded" %>

              <div class="form-check">
                <%= check_box_tag :remove_image, "1", false, class: "form-check-input", id: "remove_image_check" %>
                <%= label_tag :remove_image, "Remove current image", class: "form-check-label" %>
              </div>

            <% elsif @product.image_url.present? %>
              <img src="<%= @product.image_url %>" class="img-fluid rounded" alt="<%= @product.name %>">
            <% else %>
              <div class="text-center text-muted p-4">
                <p>No image</p>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <div class="d-flex justify-content-between">
    <%= link_to "Cancel", admin_products_path, class: "btn btn-outline-secondary" %>
    <%= f.submit (@product.new_record? ? "Create Product" : "Update Product"), class: "btn btn-primary" %>
  </div>
<% end %>
