<div class="d-flex justify-content-between align-items-center mb-4">
  <h2>Products Management</h2>
  <%= link_to "Add New Product", new_admin_product_path, class: "btn btn-primary" %>
</div>

<div class="card">
  <div class="card-body">
    <% if @products.any? %>
      <div class="table-responsive">
        <table class="table">
          <thead>
            <tr>
              <th>Image</th>
              <th>Name</th>
              <th>Category</th>
              <th>Price</th>
              <th>Stock</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% @products.each do |product| %>
              <tr>
                <td>
                  <% if product.image.attached? %>
                    <%= image_tag product.image, style: "width: 50px; height: 50px; object-fit: cover;", class: "rounded" %>
                  <% elsif product.image_url.present? %>
                    <img src="<%= product.image_url %>" style="width: 50px; height: 50px; object-fit: cover;" class="rounded" alt="<%= product.name %>">
                  <% else %>
                    <div class="bg-light rounded d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
                      <small>No img</small>
                    </div>
                  <% end %>
                </td>
                <td>
                  <strong><%= product.name %></strong>
                  <br>
                  <small class="text-muted"><%= truncate(product.description, length: 50) %></small>
                </td>
                <td><%= product.category.name %></td>
                <td>$<%= product.current_price %></td>
                <td>
                  <%= product.stock_quantity %>
                  <% unless product.in_stock? %>
                    <br><span class="badge bg-danger">Out of Stock</span>
                  <% end %>
                  <% if product.is_new? %>
                    <br><span class="badge bg-success">New</span>
                  <% end %>
                  <% if product.on_sale? %>
                    <br><span class="badge bg-warning">Sale</span>
                  <% end %>
                </td>
                <td>
                  <% if product.in_stock? %>
                    <span class="badge bg-success">Active</span>
                  <% else %>
                    <span class="badge bg-secondary">Inactive</span>
                  <% end %>
                </td>
                <td>
                  <div class="btn-group-vertical btn-group-sm">
                    <%= link_to "View", admin_product_path(product), class: "btn btn-outline-primary btn-sm" %>
                    <%= link_to "Edit", edit_admin_product_path(product), class: "btn btn-outline-secondary btn-sm" %>
                    <button type="button" class="btn btn-outline-danger btn-sm"
                            onclick="deleteProduct(<%= product.id %>, '<%= product.name %>')">
                      Delete
                    </button>
                  </div>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    <% else %>
      <div class="text-center py-4">
        <h5>No products yet</h5>
        <p class="text-muted">Start by adding your first product.</p>
        <%= link_to "Add Product", new_admin_product_path, class: "btn btn-primary" %>
      </div>
    <% end %>
  </div>
</div>

<!-- Hidden delete form -->
<form id="delete-form" style="display: none;" method="POST">
  <input type="hidden" name="_method" value="delete">
  <input type="hidden" name="authenticity_token" value="<%= form_authenticity_token %>">
</form>

<script>
function deleteProduct(productId, productName) {
  if (confirm('Are you sure you want to delete "' + productName + '"? This action cannot be undone.')) {
    const form = document.getElementById('delete-form');
    form.action = '/admin/products/' + productId;
    form.submit();
  }
}
</script>